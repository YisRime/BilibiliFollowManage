# B站关注管理

高效管理B站关注列表的油猴脚本，支持批量关注/取关、关注列表导出、关注列表同步、智能筛选、实时粉丝数获取等功能。
（注意，大批量关注可能导致被标记风控，需要过一段时间才能正常关注新用户）

## 功能特性

### 📊 智能筛选

- **关键词搜索**：按UP主昵称快速搜索
- **大会员筛选**：区分年度/月度大会员、非大会员用户
- **认证状态**：筛选个人认证、机构认证或未认证用户
- **账号状态**：识别并筛选失效账号（已注销用户）
- **关注关系**：区分单向关注和互相关注
- **时间范围**：按关注时间进行日期范围筛选
- **粉丝数段**：按粉丝数量分段筛选（1万以下/1万-10万/10万-100万/100万以上）

### 🔢 实时数据获取

- **粉丝数获取**：自动获取所有关注用户的实时粉丝数
- **可视区优先**：优先获取当前可见用户的粉丝数据
- **智能缓存**：本地缓存用户数据，减少重复请求
- **进度显示**：实时显示数据获取进度

### ⚡ 批量操作

- **批量取关**：支持批量取消关注选中用户
- **批量关注**：支持通过文件导入批量关注用户
- **全选功能**：一键选择所有筛选结果
- **操作确认**：操作前显示详细确认信息
- **进度反馈**：实时显示批量操作进度（包含成功/失败）

### 📁 数据管理

- **导出功能**：导出选中用户列表为TXT文件
- **导入功能**：从TXT文件导入用户并批量关注
- **同步功能**：与文件内容完全同步关注列表（添加缺失用户，删除多余用户）
- **格式支持**：标准MID,用户名格式，兼容多种数据源

### 🛡️ 性能优化

- **防抖处理**：筛选和滚动事件防抖，避免频繁请求
- **分批渲染**：大量数据分批渲染，防止页面卡顿
- **内存管理**：自动清理内存缓存，优化页面性能
- **错误恢复**：网络错误自动重试，操作可随时取消
- **虚拟滚动**：大数据量时启用虚拟滚动优化

### 🎨 用户界面

- **响应式设计**：适配不同屏幕尺寸
- **排序功能**：支持按昵称、粉丝数、关注时间排序
- **状态指示**：清晰显示用户认证状态、大会员等级
- **操作反馈**：操作过程中提供视觉反馈
- **进度显示**：实时显示导入/同步进度百分比

## 使用方法

1. **安装脚本**：通过油猴插件安装此脚本
2. **打开关注页面**：访问B站个人空间的关注列表页面(可能需要手动点击刷新载入脚本，这与B站的router机制有关)
3. **点击管理按钮**：页面右侧会显示"管理关注"按钮
4. **使用功能**：
   - 使用筛选器快速找到目标用户
   - 勾选需要取关的用户
   - 点击"取关选中用户"进行批量操作
   - 点击"获取全部粉丝数"获取所有用户数据
   - 使用"导出选中用户"保存当前选择
   - 使用"导入关注列表"从文件批量关注
   - 使用"从文件同步"完全同步关注列表

## 导入导出格式

支持标准的TXT文件格式：
```
MID,用户名
123456,示例用户1
789012,示例用户2
```

## 技术特点

### 🚀 性能优化

- **API限制友好**：合理控制请求频率（500ms延迟），避免触发API限制
- **分批处理**：大量数据分批处理，单批次最多处理100个用户
- **内存管理**：智能内存清理，自动GC触发，防止内存泄漏
- **虚拟滚动**：超过5000项时启用虚拟滚动，提升渲染性能
- **防抖优化**：筛选防抖250ms，滚动防抖200ms，优化用户体验

### 💾 数据管理

- **智能缓存**：30天有效期的本地缓存，内存+localStorage双重缓存
- **筛选缓存**：缓存筛选结果，避免重复计算
- **增量更新**：实时更新粉丝数据，可视区域优先获取
- **数据持久化**：操作过程中定期保存，防止数据丢失

### 🛡️ 错误处理

- **网络容错**：自动重试机制，最多重试2次
- **超时控制**：10秒请求超时，避免长时间等待
- **优雅降级**：获取失败时显示默认值，不影响整体功能
- **操作监控**：监控长时间运行的操作，防止页面卡死

### 🎛️ 操作控制

- **取消机制**：所有长时间操作都支持随时取消
- **进度反馈**：实时显示操作进度和状态
- **批量限制**：合理的并发控制，避免系统过载
- **状态恢复**：操作中断后自动恢复状态和数据
- **预览确认**：导入/同步前显示操作预览，确认后再执行

## 安装方式

[原下载链接](https://greasyfork.org/zh-CN/scripts/537856-b%E7%AB%99%E5%85%B3%E6%B3%A8%E7%AE%A1%E7%90%86)
迭代版本未发布

## 注意事项

- 请合理使用批量操作功能，避免频繁操作触发限制（大批量关注高概率触发！）
- 首次使用会自动获取关注列表，可能需要一些时间
- 数据会缓存在本地，可手动清除缓存重新加载
- 导入/同步功能需要标准格式的TXT文件
- 连续操作失败时会自动停止，请检查网络或账号状态后重试
- 建议在操作前先导出备份当前关注列表

## 更新日志

### 最新改进
3.1：优化了导入文件相关的代码和进度条的显示方式
- 统一导入/同步关注列表使用的接口
- 增强进度条显示方式（包含成功和失败进度）

3.0：主要新增了**导入导出功能**、**文件同步功能**和**失败保护机制**，让关注列表管理更加全面和安全。
- 新增导入/导出功能，支持批量关注管理
- 新增文件同步功能，完全同步关注列表
- 优化批量操作处理器，支持失败保护机制
- 统一关注/取消关注操作接口
- 增强错误处理和用户提示
- 把清除缓存改为了清除缓存并自动重新获取